<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attack vs Defense Performance Table</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }
        .controls {
            margin: 20px 0;
            text-align: center;
        }
        select {
            padding: 8px 12px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 0 10px;
        }
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        th, td {
            padding: 12px 8px;
            text-align: center;
            border: 1px solid #ddd;
            transition: all 0.3s ease;
        }
        th {
            background-color: #f8f9fa;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        .attack-row:hover {
            background-color: #f8f9fa;
        }
        .defense-cell {
            cursor: pointer;
            position: relative;
        }
        .defense-cell:hover {
            background-color: #e9ecef;
            transform: scale(1.05);
        }
        .high-value {
            background-color: #d4edda;
            color: #155724;
        }
        .medium-value {
            background-color: #fff3cd;
            color: #856404;
        }
        .low-value {
            background-color: #f8d7da;
            color: #721c24;
        }
        .tooltip {
            position: absolute;
            padding: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
            font-size: 12px;
        }
        .highlight {
            background-color: #007bff !important;
            color: white !important;
        }
        .sortable {
            cursor: pointer;
        }
        .sortable:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Attack vs Defense Performance Table</h1>
        
        <div class="controls">
            <label for="sort-select">Sort Table by:</label>
            <select id="sort-select">
                <option value="attack">Attack Name</option>
                <option value="performance">Overall Performance</option>
            </select>
            
            <label for="highlight-select">Highlight Values:</label>
            <select id="highlight-select">
                <option value="none">None</option>
                <option value="high">High (>70%)</option>
                <option value="low">Low (<30%)</option>
                <option value="medium">Medium (30-70%)</option>
            </select>
        </div>
        
        <div class="table-container">
            <table id="performance-table">
                <!-- Table will be populated by JavaScript -->
            </table>
        </div>
    </div>

    <script>
        // Data from the provided table
        const data = [
            { attack: "No Attack", ERM: 94.85, DA: 94.21, PGDT: 84.38, TRADES: 80.42, MART: 81.54, RS: 89.45, IBP: 48.4, PRL: 93.82, TandT: 94.23 },
            { attack: "TIFGSM", ERM: 35.1, DA: 33, PGDT: 65.7, TRADES: 62.9, MART: 69.1, RS: 45.4, IBP: 40.2, PRL: 34, TandT: 92.8 },
            { attack: "MIFGSM", ERM: 0, DA: 0, PGDT: 50.9, TRADES: 51.9, MART: 50.5, RS: 5.8, IBP: 38.1, PRL: 0, TandT: 92.8 },
            { attack: "DIFGSM", ERM: 1, DA: 0, PGDT: 51.75, TRADES: 50.5, MART: 53.6, RS: 4.1, IBP: 38.1, PRL: 3.1, TandT: 92.8 },
            { attack: "VMIFGSM", ERM: 0, DA: 0, PGDT: 51.1, TRADES: 50.9, MART: 51.9, RS: 4.1, IBP: 38.1, PRL: 0, TandT: 93.9 },
            { attack: "TPGD", ERM: 38.1, DA: 39.2, PGDT: 69.3, TRADES: 69.1, MART: 70.1, RS: 48.5, IBP: 50, PRL: 28.9, TandT: 91.8 },
            { attack: "FGSM", ERM: 29.9, DA: 25.8, PGDT: 57.95, TRADES: 54.6, MART: 61.9, RS: 28.9, IBP: 38.1, PRL: 25.8, TandT: 93.8 },
            { attack: "RFGSM", ERM: 0, DA: 0, PGDT: 49.15, TRADES: 50.4, MART: 48.5, RS: 3.7, IBP: 38.1, PRL: 0, TandT: 90 },
            { attack: "BIM", ERM: 0, DA: 0, PGDT: 52, TRADES: 57.2, MART: 47.4, RS: 2.1, IBP: 38.1, PRL: 0, TandT: 90.7 },
            { attack: "FAB", ERM: 1, DA: 2.1, PGDT: 43, TRADES: 46.4, MART: 40.2, RS: 5.3, IBP: 38.1, PRL: 4.1, TandT: 90.1 },
            { attack: "CW", ERM: 0, DA: 0, PGDT: 32.2, TRADES: 35.1, MART: 29.9, RS: 1, IBP: 40.2, PRL: 1, TandT: 92.9 },
            { attack: "UPGD", ERM: 0, DA: 0, PGDT: 49.85, TRADES: 50.5, MART: 49.8, RS: 5.1, IBP: 38.1, PRL: 0, TandT: 93.8 },
            { attack: "FFGSM", ERM: 19.6, DA: 23.7, PGDT: 60.55, TRADES: 55.7, MART: 66, RS: 33, IBP: 42.3, PRL: 29.9, TandT: 92.8 },
            { attack: "Jitter", ERM: 11.3, DA: 12.4, PGDT: 48.15, TRADES: 47.4, MART: 49.5, RS: 34, IBP: 39.2, PRL: 24.7, TandT: 90.7 },
            { attack: "PGD", ERM: 0, DA: 0, PGDT: 57.4, TRADES: 54.6, MART: 60.8, RS: 7.2, IBP: 40.2, PRL: 0, TandT: 91.8 },
            { attack: "EOTPGD", ERM: 0, DA: 0, PGDT: 50.1, TRADES: 50.3, MART: 50.5, RS: 3, IBP: 38.1, PRL: 0, TandT: 90.7 },
            { attack: "APGD", ERM: 0, DA: 0, PGDT: 48.4, TRADES: 51, MART: 46.4, RS: 1, IBP: 38.1, PRL: 0, TandT: 90.7 },
            { attack: "NIFGSM", ERM: 0, DA: 0, PGDT: 57.95, TRADES: 56.7, MART: 59.8, RS: 7.2, IBP: 38.1, PRL: 1, TandT: 92.8 },
            { attack: "SiniFGSM", ERM: 4.1, DA: 1, PGDT: 59, TRADES: 56.7, MART: 61.9, RS: 23.7, IBP: 38.1, PRL: 12.4, TandT: 93.7 },
            { attack: "VNIFGSM", ERM: 0, DA: 0, PGDT: 50.45, TRADES: 53, MART: 48.5, RS: 5.1, IBP: 38.1, PRL: 0, TandT: 92.9 },
            { attack: "APGDT", ERM: 0, DA: 0, PGDT: 40.9, TRADES: 44.3, MART: 38.1, RS: 0, IBP: 38.1, PRL: 0, TandT: 88.7 },
            { attack: "Square", ERM: 0, DA: 1, PGDT: 50.4, TRADES: 54, MART: 47.4, RS: 3.1, IBP: 38.1, PRL: 2.1, TandT: 88.08 },
            { attack: "Add Gaussian Noise", ERM: 25.8, DA: 43.3, PGDT: 79.1, TRADES: 78.4, MART: 80.4, RS: 74.2, IBP: 42.3, PRL: 45.4, TandT: 87.6 },
            { attack: "OnePixel", ERM: 79.4, DA: 83.5, PGDT: 78.05, TRADES: 74.2, MART: 82.5, RS: 83.5, IBP: 42.5, PRL: 80.4, TandT: 89.7 },
            { attack: "Pixle", ERM: 0, DA: 0, PGDT: 12.55, TRADES: 11.3, MART: 14.4, RS: 1, IBP: 10.3, PRL: 0, TandT: 17.5 },
            { attack: "PGDL2", ERM: 1, DA: 0, PGDT: 35.8, TRADES: 36.1, MART: 36.1, RS: 5.2, IBP: 36.1, PRL: 0, TandT: 92.9 }
        ];

        // Defense methods (excluding 'attack' column)
        const defenses = Object.keys(data[0]).filter(key => key !== 'attack');
        
        // Create tooltip
        const tooltip = d3.select("body")
            .append("div")
            .attr("class", "tooltip");

        // Initial table creation
        createTable(data);

        // Event listeners
        d3.select("#sort-select").on("change", function() {
            const sortBy = this.value;
            const sortedData = sortData(data, sortBy);
            createTable(sortedData);
        });

        d3.select("#highlight-select").on("change", function() {
            const highlightType = this.value;
            highlightCells(highlightType);
        });

        function sortData(data, sortBy) {
            const sortedData = [...data];
            
            if (sortBy === "attack") {
                sortedData.sort((a, b) => a.attack.localeCompare(b.attack));
            } else if (sortBy === "performance") {
                sortedData.sort((a, b) => {
                    const aAvg = calculateAveragePerformance(a);
                    const bAvg = calculateAveragePerformance(b);
                    return bAvg - aAvg;
                });
            }
            
            return sortedData;
        }

        function calculateAveragePerformance(attackData) {
            let sum = 0;
            defenses.forEach(defense => {
                sum += attackData[defense];
            });
            return sum / defenses.length;
        }

        function createTable(tableData) {
            const table = d3.select("#performance-table");
            table.selectAll("*").remove();

            // Create header row
            const thead = table.append("thead");
            const headerRow = thead.append("tr");
            
            // Attack column header
            headerRow.append("th")
                .text("Attack")
                .attr("class", "sortable")
                .on("click", () => {
                    const sortedData = sortData(tableData, "attack");
                    createTable(sortedData);
                });

            // Defense method headers
            defenses.forEach(defense => {
                headerRow.append("th")
                    .text(defense)
                    .attr("class", "sortable")
                    .on("click", () => {
                        sortByDefense(defense);
                    });
            });

            // Create table body
            const tbody = table.append("tbody");

            // Create data rows
            const rows = tbody.selectAll("tr")
                .data(tableData)
                .enter()
                .append("tr")
                .attr("class", "attack-row")
                .style("opacity", 0);

            // For each row, create cells in the correct order
            rows.each(function(d) {
                const row = d3.select(this);
                
                // Attack name cell
                row.append("td")
                    .text(d.attack)
                    .style("font-weight", "bold")
                    .style("text-align", "left")
                    .style("padding-left", "15px");
                
                // Defense performance cells
                defenses.forEach(defense => {
                    const value = d[defense];
                    const cell = row.append("td")
                        .attr("class", "defense-cell")
                        .text(value)
                        .attr("data-value", value)
                        .attr("data-defense", defense);
                    
                    // Apply color coding
                    if (value > 70) {
                        cell.classed("high-value", true);
                    } else if (value < 30) {
                        cell.classed("low-value", true);
                    } else {
                        cell.classed("medium-value", true);
                    }
                    
                    // Add event listeners
                    cell.on("mouseover", function(event) {
                        tooltip
                            .style("opacity", 1)
                            .html(`<strong>${d.attack}</strong><br/>${defense}: ${value}%`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                        
                        // Highlight entire row and column
                        cell.classed("highlight", true);
                        d3.selectAll(`td[data-defense="${defense}"]`).classed("highlight", true);
                        row.classed("highlight", true);
                    })
                    .on("mouseout", function() {
                        tooltip.style("opacity", 0);
                        
                        // Remove highlights
                        cell.classed("highlight", false);
                        d3.selectAll(`td[data-defense="${defense}"]`).classed("highlight", false);
                        row.classed("highlight", false);
                    })
                    .on("click", function() {
                        alert(`Attack: ${d.attack}\nDefense: ${defense}\nPerformance: ${value}%`);
                    });
                });
            });

            // Apply fade-in transition after cells are created
            rows.transition()
                .duration(500)
                .delay((d, i) => i * 50)
                .style("opacity", 1);
        }

        function sortByDefense(defense) {
            const sortedData = [...data].sort((a, b) => b[defense] - a[defense]);
            createTable(sortedData);
        }

        function highlightCells(highlightType) {
            d3.selectAll(".defense-cell")
                .classed("highlight", false)
                .each(function() {
                    const value = parseFloat(d3.select(this).attr("data-value"));
                    const cell = d3.select(this);
                    
                    if (highlightType === "high" && value > 70) {
                        cell.classed("highlight", true);
                    } else if (highlightType === "low" && value < 30) {
                        cell.classed("highlight", true);
                    } else if (highlightType === "medium" && value >= 30 && value <= 70) {
                        cell.classed("highlight", true);
                    }
                });
        }
    </script>
</body>
</html>